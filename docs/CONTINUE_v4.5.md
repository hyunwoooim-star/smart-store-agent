# v4.5 이어서 작업하기

**작성일**: 2026-01-25
**마지막 커밋**: `feat(v4.5): 알리익스프레스 중심 UX 개선 + 비용 구조 수정`

---

## 현재 완료된 작업

### 1. URL 자동 추출 UI (sourcing_tab.py)
- [x] URL 입력 필드 최상단 배치
- [x] 플랫폼 자동 감지 (1688/알리/타오바오)
- [x] "정보 추출" 버튼
- [x] 추출 정보 미리보기 (이미지, 가격, 무게)
- [x] 버튼 활성화 조건 개선 (URL만 있어도 OK)

### 2. 알리익스프레스 비용 구조 (logic.py)
- [x] 구매대행 수수료 0% (직구)
- [x] 중국 내 배송비 0원 (판매자 처리)
- [x] 국제 배송비 0원 (무료배송 가정)

### 3. WSL 캐시 문제 우회 (config.py)
- [x] `exchange_rate_usd`, `exchange_rate_usd_cny` 주석 처리
- [x] USD_CNY_RATE = 7.2 하드코딩 (임시)

---

## 미완료 작업 (다음 세션)

### P0: 알리 URL 자동 추출 실패
**문제**: 알리익스프레스는 JavaScript 렌더링 → 단순 HTTP 요청으론 데이터 추출 불가

**시도한 방법**:
1. ~~Apify epctex/aliexpress-scraper~~ → 유료 Actor
2. ~~직접 HTTP 파싱~~ → JS 렌더링 후 데이터 로딩

**해결 옵션**:
1. **Apify 유료** ($20/월) - 가장 확실
2. **수동 입력 UX 개선** - 가격/상품명만 입력 (현실적)
3. **Playwright 헤드리스** - WSL 환경 복잡

### P1: 경쟁사 목록 미표시
- 시장 조사 결과는 있는데 UI에서 0개로 표시
- `_render_results()` 함수 디버깅 필요

### P2: Plotly 에러
- WSL에서 plotly 설치됐는데 import 에러 발생
- 캐시 문제 또는 경로 문제일 수 있음

---

## 핵심 파일

| 파일 | 역할 | 라인 |
|------|------|------|
| `src/ui/tabs/sourcing_tab.py` | URL 추출 UI | 36-103 |
| `src/domain/logic.py` | 알리 비용 계산 | 84-115 |
| `src/core/config.py` | 환율 설정 (주석) | 35-38 |

---

## 서버 실행 명령어

```bash
# WSL에서 실행
source ~/smart-venv/.venv/bin/activate
cd '/mnt/c/Users/임현우/Desktop/현우 작업폴더/smart'
PYTHONDONTWRITEBYTECODE=1 streamlit run src/ui/app.py --server.port 8501
```

---

## 테스트 시나리오

### 알리익스프레스 마진 계산 테스트
1. 소싱 플랫폼: 알리익스프레스 (달러) 선택
2. 가격: $10 입력
3. 예상 비용 구조:
   - 상품원가: 72 위안 × 195 = ₩14,040
   - 구매대행: ₩0 (알리 직구)
   - 국제배송: ₩0 (무료배송)
   - 관부가세: 약 20%
   - 국내택배: ₩3,500

### 1688 마진 계산 테스트
1. 소싱 플랫폼: 1688 (위안) 선택
2. 가격: 35위안 입력
3. 예상 비용 구조:
   - 상품원가: 35 × 195 = ₩6,825
   - 구매대행: 10%
   - 중국배송: ₩3,000
   - 국제배송: kg당 ₩8,000

---

## Git 상태

```
main 브랜치
origin/main보다 3커밋 앞섬 (push 필요)
```

---

## 다음 세션 시작 시

1. 이 문서 읽기
2. 서버 실행
3. P0 (알리 추출) 또는 P1 (경쟁사 목록) 해결
4. 테스트 후 커밋
